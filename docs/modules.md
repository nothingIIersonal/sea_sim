# Модули

## Концепция
---

Модули представляют собой динамические библиотеки. Подгрузившись в приложение, они начинают свою работу.

<br>

## Архитектура модулей
---

Модуль включает в себя четыре основные функции - функция инициализации (<b>init</b>), функция однократной обработки (<b>exec</b>), горячая функция (<b>hot</b>) и функция выхода (<b>exit</b>). Каждая из этих функций получает в качестве аргумента объект типа "<b>Interconnect  &&</b>". С помощью этого объекта происходит любое взаимодействие с приложением. Данный объект в любую другую функцию нужно передавать <b>только по ссылке</b>.

<br>

### Подробнее о функциях
---
<br>

#### Функция <b>init</b>
---

Задача функции <b>init</b> заключается в начальной инициализации модуля. Это может быть, например, задание интерфейса для ввода пользовательских данных или создание стартовых объектов (кораблей).

<br>

#### Функция <b>exec</b>
---

Функция <b>exec</b> вызывается при нажатии на любую кнопку в отображенном пользовательском интерфейсе ввода. Например, в функции <b>init</b> можно задать список для выбора корабля и кнопку подтверждения выбора. При нажатии на эту кнопку как раз и будет вызвана функция <b>exec</b>. Внутри этой функции можно узнать, от какой кнопки был сделан вызов и в соответствии с этой информацией выполнить нужную логику - например, вывести всю инфомарцию о выбранном судне в область пользовательского вывода.

<br>

#### Функция <b>hot</b>
---

Эта функция вызывается каждый кадр. В неё можно поместить логику рассчёта нового положения корабля и логику рендера объектов. 

<br>

#### Функция <b>exit</b>
---

Эта функция вызывается при выгрузке модуля. В неё можно поместить логику освобождения выделенной памяти, уничтожения объектов и всего остального, чего не должно остаться после извлечения модуля. 

<br>

### Про <b>Interconnect</b>
---

Объект <b>Interconnect</b> включает в себя следующие важные объекты:
- <b>wgti</b> - этот объект позволяет составлять пользовательский интерфейс ввода;
- <b>wgto</b> - этот объект позволяет составлять пользовательский интерфейс вывода;
- <b>render</b> - этот объект позволяет рисовать графические объекты (в том числе устанавливать цвет рисуемым объектам);
- <b>environment</b> - этот объект содержит в себе общие для всех модулей данные, такие как, например, текущая позиция курсора, скорость симулации и так далее;
- <b>ships</b> - этот объект позволяет управлять суднами.

<br>

Рассмотрим эти объекты подробнее.

<br>

#### Объект <b>wgti</b>
---

| Метод | Аргументы | Описание |
| - | - | - |
| void set_module_title() | <b>const std::string& title</b> - имя модуля | Установка названия модуля |
| void sameline() | - | Оставить следующий виджет на той же строке |
| void add_text() | <b>const std::string& text</b> - текст  | Добавление виджета текста |
| void add_button() | <b>const std::string& identifier</b> - уникальный идентификатор; <br><br> <b>const std::string& text</b> - текст на кнопке | Добавление виджета кнопки |
| void add_sliderint() | <b>const std::string& identifier</b> - уникальный идентификатор; <br><br> <b>int64_t from</b> - значение "от"; <br><br> <b>int64_t to</b> - значение "до"; <br><br> <b>bool keep_value</b> - не затирать введённое пользователем значение при повторной отправке элемента (с таким же уникальным идентификатором) | Добавление виджета слайдера ввода целого числа |
| void add_sliderfloat() | <b>const std::string& identifier</b> - уникальный идентификатор; <br><br> <b>float from</b> - значение "от"; <br><br> <b>float to</b> - значение "до"; <br><br> <b>uint64_t precision</b> - точность; <br><br> <b>bool keep_value</b> - не затирать введённое пользователем значение при повторной отправке элемента (с таким же уникальным идентификатором) | Добавление виджета слайдера ввода дробного числа |
| void add_inputtext() | <b>const std::string& identifier</b> - уникальный идентификатор; <br><br> <b>const std::string& placeholder</b> - подсказка; <br><br> <b>bool keep_value</b> - не затирать введённое пользователем значение при повторной отправке элемента (с таким же уникальным идентификатором) | Добавление виджета ввода текста |
| void add_inputint() | <b>const std::string& identifier</b> - уникальный идентификатор; <br><br> <b>bool keep_value</b> - не затирать введённое пользователем значение при повторной отправке элемента (с таким же уникальным идентификатором) | Добавление виджета ввода целого числа |
| void add_inputfloat() | <b>const std::string& identifier</b> - уникальный идентификатор; <br><br> <b>bool keep_value</b> - не затирать введённое пользователем значение при повторной отправке элемента (с таким же уникальным идентификатором) | Добавление виджета ввода дробного числа |
| void add_checkbox() | <b>const std::string& identifier</b> - уникальный идентификатор; <br><br> <b>const std::string& text</b> - текст описания опции; <br><br> <b>bool keep_value</b> - не затирать введённое пользователем значение при повторной отправке элемента (с таким же уникальным идентификатором) | Добавление виджета флажка |
| void add_radiobutton() | <b>const std::string& identifier</b> - уникальный идентификатор; <br><br> <b>const std::vector\<std::string\>& elements</b> - набор элементов предоставляемых для выбора; <br><br> <b>bool keep_value</b> - не затирать введённое пользователем значение при повторной отправке элемента (с таким же уникальным идентификатором) | Добавление виджета радиокнопок |
| void add_dropdownlist() | <b>const std::string& identifier</b> - уникальный идентификатор; <br><br> <b>const std::vector\<std::string\>& elements</b> - набор элементов предоставляемых для выбора; <br><br> <b>bool keep_value</b> - не затирать введённое пользователем значение при повторной отправке элемента (с таким же уникальным идентификатором) | Добавление виджета выпадающего списка |
| void send() | - | Отправляет виджеты на отображение |

<br>

#### Объект <b>wgto</b>
---

| Метод | Аргументы | Описание |
| - | - | - |
| void sameline() | - | Оставить следующий виджет на той же строке |
| void add_text() | <b>const std::string& text</b> - текст  | Добавление виджета текста |
| void send() | - | Отправляет виджеты на отображение |

<br>

#### Объект <b>render</b>
---

| Метод | Аргументы | Описание |
| - | - | - |
| void set_fill_color() | <b>graphics::Color color</b> - цвет заливки | Устанавливает цвет заполнения следующему для отрисовки объекту |
| void set_outline_color() | <b>graphics::Color color</b> - цвет контура | Устанавливает цвет контура следующему для отрисовки объекту |
| void draw_line() | <b>geom::Vector2f a</b> - точка начала; <br><br> <b>geom::Vector2f b</b> - точка конца; <br><br> <b>float width</b> - ширина линии | Рисует линию толщиной <b>width</b> от точки <b>a</b> до точки <b>b</b> |
| void draw_circle() | <b>geom::Vector2f pos</b> - точка центра; <br><br> <b>float radius</b> - радиус; <br><br> <b>float border_width</b> - ширина контура | Рисует окружность радиуса <b>radius</b> с шириной контура <b>border_width</b> в точке <b>pos</b> |
| void draw_triangle() | <b>geom::Vector2f a</b> - первая точка; <br><br> <b>geom::Vector2f b</b> - вторая точка; <br><br> <b>geom::Vector2f c</b> - третья точка ; <br><br> <b>float border_width</b> - ширина контура | Рисует треугольник с шириной контура <b>border_width</b> по трём точкам |
| void draw_ship() | <b>const Ship& ship</b> - корабль | Рисует корабль <b>ship</b> |

<br>

#### Объект <b>environment</b>
---

| Поле | Тип | Описание |
| - | - | - |
| view_area | geom::Vector2u | Размер видимой области (сцены) |
| mouse_position | geom::Vector2u | Текущая позиция курсора мыши |
| mouse_buttons | uint8_t | Зажатые кнопки мыши (с младшего бита: 1 - ЛКМ, 2 - СКМ, 4 - ПКМ) |
| sim_speed | int8_t | Скорость симулации (в степенях двойки) |
| map_scale | int | - |
| paused | bool | Пауза |

<br>

#### Объект <b>ships</b>
---

| Метод | Аргументы | Описание |
| - | - | - |
| void create | <b>const std::string& identifier</b> - уникальный идентификатор корабля; <br><br> <b>geom::Vector2f position</b> - позиция появления; <br><br> <b>graphics::Color fill_color</b> - цвет заливки; <br><br> <b>graphics::Color outline_color</b> - цвет обводки; <br><br> <b>float angle</b> - текущий угол, направление; <br><br> <b>float desired_angle</b> - желаемое направление; <br><br> <b>float speed</b> - скорость движения; <br><br> <b>float max_speed</b> - максимальная скорость движения; <br><br> <b>float rotation_speed</b> - скорость вращения | Создание корабля |
| void set_position | <b>const std::string& identifier</b> - уникальный идентификатор корабля;<br><br> <b>geom::Vector2f position</b> - позиция| Установить позицию корабля |
| void set_angle | <b>const std::string& identifier</b> - уникальный идентификатор корабля;<br><br> <b>float angle</b> - угол | Установить направления (угол) корабля |
| void set_desired_angle | <b>const std::string& identifier</b> - уникальный идентификатор корабля;<br><br> <b>float desired_angle</b> - желаемый угол| Установить желаемое направление (желаемый угол) корабля |
| void set_speed | <b>const std::string& identifier</b> - уникальный идентификатор корабля;<br><br> <b>float speed</b> - скорость| Установить скорость движения корабля |
| void set_max_speed | <b>const std::string& identifier</b> - уникальный идентификатор корабля;<br><br> <b>float max_speed</b> - максимальная скорость| Установить максимальную скорость движения корабля |
| void set_rotation_speed | <b>const std::string& identifier</b> - уникальный идентификатор корабля;<br><br> <b>float rotation_speed</b> - скорость вращения | Установить скорость вращения корабля |
| std::optional<Ship> get_by_id | <b>const std::string& identifier</b> - уникальный идентификатор корабля| Получить корабль по его уникальному идентификатору |
| std::vector<Ship> get_all | - | Получить вектор всех корблей |

<br>

Видно, что некоторые методы возвращают контейнер "<b>std::optional\<\></b>" на желамый объект. Это позволяет проверять существование запрошенного объекта перед его использованием:

```c++
auto ship = ic.ships.get_by_id("крейсер_0");

if ( !ship )
{
    ic.wgto.add_text("Корабль не найден.");
    return;
}
```

<br>